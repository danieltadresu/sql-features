CREATE OR REPLACE PACKAGE PKG_DATOS IS
    edad_postulante     number(3);
    function get_edad(fechaNacimiento date) return number;
    
    ptje_edad           number(3);
    function get_ptje_edad(fechaNacimiento date) return number;
    
    cantidad_cargas     number(10);    
    function get_cantidad_cargas(runPostulante number) return number;
    
    ptje_cargas        number(3);
    function get_ptje_cargas(cantidadCargas number) return number; 
    
    estado_civil       varchar2(60);
    function get_estado_civil(runPostulante number) return varchar2;
    
    ptje_estado_civil  number(3);
    function get_ptje_estado_civ(runPostulante number) return number;
    
    acred_indigena  varchar2(60);
    function get_acred_indigena(runPostulante number) return varchar2;
    
end PKG_DATOS;

CREATE OR REPLACE PACKAGE BODY PKG_DATOS IS 
    function get_edad(fechaNacimiento date) return number IS
    begin
        select
            extract(year from sysdate) - extract(year from fechaNacimiento)
            into edad_postulante
        from dual;
    return edad_postulante;
    end get_edad;

    function get_ptje_edad(fechaNacimiento date) return number IS
    begin
        select
            puntaje into ptje_edad
        from PUNTAJE_EDAD
        where get_edad(fechaNacimiento) between TRAMO_INF and TRAMO_SUP;
        return ptje_edad;
    end get_ptje_edad;
    
    function get_cantidad_cargas(runPostulante number) return number IS
    begin
        select
            count(RUN_CARGA) into cantidad_cargas 
        from CARGA_FAMILIAR
        where run_postulante = runPostulante
        group by run_postulante;
    return cantidad_cargas;
    end get_cantidad_cargas;
    
    function get_ptje_cargas(cantidadCargas number) return number IS
    begin
        select
            puntaje into ptje_cargas
        from PUNTAJE_CARGA_FAMILIAR
        where cantidadCargas between TRAMO_INF and TRAMO_SUP;
        return ptje_cargas;
    end get_ptje_cargas;  
    
    function get_estado_civil(runPostulante number) return varchar2 IS 
    begin
        select
            est_civ.descripcion into estado_civil
        from ESTADO_CIVIL est_civ
        join POSTULANTE p
        on est_civ.id_estado_civil = p.id_estado_civil
        where p.run_postulante = runPostulante;
        return estado_civil;
    end get_estado_civil;
    
    
    function get_ptje_estado_civ(runPostulante number) return number IS 
    begin
        select
            est_civ.puntaje_est_civil into ptje_estado_civil
        from ESTADO_CIVIL est_civ
        join POSTULANTE p
        on est_civ.id_estado_civil = p.id_estado_civil
        where p.run_postulante = runPostulante;
        
        return ptje_estado_civil;
    end;
    
    function get_acred_indigena(runPostulante number) return varchar2 IS 
    begin
        select
            acred.descripcion into acred_indigena
        from ACREDITACION_INDIGENA acred
        join POSTULANTE p
        on acred.id_acreditacion = p.id_acreditacion
        where p.run_postulante = runPostulante;
        return acred_indigena;
    end get_acred_indigena;
end PKG_DATOS;
